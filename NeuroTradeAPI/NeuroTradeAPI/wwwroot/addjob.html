<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Downloader - Add Job</title>
    
        <script src="/jquery-min.js" type="text/javascript"></script>
		<style>
			.canhazbreaks {
				white-space: pre-line;
			}
			.highlight {
				background: #aaffaa;
			}
		</style>
		<script>
			function table_log(id, msg)
			{
				$("table#"+id).prepend('<tr><td>'+new Date().toLocaleString()+
							'</td><td class="canhazbreaks">'+msg+'</td></tr>');
			}
            function api_call()
            {
                $.post("/api/v0/jobs",{path:$("input#addr_tf").val()},
                     (data, status) => {
						table_log('tasks', status == 'success' ? 'Task accepted' : status);
					 });
            };
            setInterval(function() {
                $.get("/api/v0/jobs", function(data, status) {
                    if (status != 'nocontent')
						table_log('responses', data);
                    }
                )
            }, 1500);
			function api_delete()
			{
				var del_id = $("input#del_batch_tf").val();
				if (!confirm("Are you sure?")) return;
				table_log('tasks', 'Task: delete batch #'+del_id);
				$.ajax({
							url: "/api/v0/quotes/"+del_id,
							data: {passphrase:del_id+".salt.pepper"},
							type: "DELETE",
							success: (data, status) => {
								table_log('responses', status == 'success' ? 'Batch deleted' : status);
							}
						});
				$("input#del_batch_tf").val("");
			}
        </script>
    </head>
    <body style="padding: 10px;">
        <h1 style="text-align:left;" class="highlight">Neuro Trade</h1>
        
		<span>Get links from  
			<a href="https://www.finam.ru/profile/mosbirzha-fyuchersy/rts-12-17-riz7/export/?market=14&em=453103&code=RIZ7&apply=0&df=1&mf=11&yf=2017&from=01.12.2017&dt=1&mt=11&yt=2017&to=01.12.2017&p=5&f=RIZ7_171201_171201&e=.csv&cn=RIZ7&dtf=1&tmf=1&MSOR=0&mstime=on&mstimever=1&sep=1&sep2=1&datf=1&at=1&fsp=1">Finam</a>, or drag'n'drop these into address field: 
			<a href="http://export.finam.ru/SPFB.RTKM-12.17_171201_171201.csv?market=14&em=481309&code=SPFB.RTKM-12.17&apply=0&df=1&mf=11&yf=2017&from=01.12.2017&dt=1&mt=11&yt=2017&to=01.12.2017&p=5&f=SPFB.RTKM-12.17_171201_171201&e=.csv&cn=SPFB.RTKM-12.17&dtf=1&tmf=1&MSOR=0&mstime=on&mstimever=1&sep=1&sep2=1&datf=1&at=1&fsp=1">Random 1</a>
			<a href="http://export.finam.ru/fine15.csv?market=14&em=453103&code=SPFB.RTS-12.17&apply=0&df=1&mf=11&yf=2017&from=01.12.2017&dt=1&mt=11&yt=2017&to=01.12.2017&p=5&f=fine15&e=.csv&cn=SPFB.RTS-12.17&dtf=1&tmf=1&MSOR=0&mstime=on&mstimever=1&sep=1&sep2=1&datf=1&at=1&fsp=1">Random 2</a>
			<a href="http://export.finam.ru/SPFB.SBRF-12.17_171130_171201.csv?market=14&em=467497&code=SPFB.SBRF-12.17&apply=0&df=30&mf=10&yf=2017&from=30.11.2017&dt=1&mt=11&yt=2017&to=01.12.2017&p=7&f=SPFB.SBRF-12.17_171130_171201&e=.csv&cn=SPFB.SBRF-12.17&dtf=1&tmf=1&MSOR=0&mstime=on&mstimever=1&sep=1&sep2=1&datf=1&at=1&fsp=1">Random 3</a>. In your database: view 
			<a href="/api/v0/quotes">all the batches</a> or
			<a href="/api/v0/quotes/filter?instrument=1&from=2010-12-05T13:00:00&to=2013-12-05T13:00:00">filter them</a>.
		</span>
		<br/>
		<form action="javascript:api_delete();">
            <label for="addr_tf">Batch id</label>
            <input type="text" id="del_batch_tf"/>
            <input type="submit" value="Remove"/>
        </form>
		<h2>Add jobs for Downloader</h2>
		<br/>
        <form action="javascript:api_call();">
            <label for="addr_tf">Address</label>
            <input type="text" id="addr_tf" style="width: 500px" value="http://export.finam.ru/SPFB.RTS-12.17_171205_171205.csv?market=14&em=453103&code=SPFB.RTS-12.17&apply=0&df=5&mf=11&yf=2017&from=05.12.2017&dt=5&mt=11&yt=2017&to=05.12.2017&p=7&f=SPFB.RTS-12.17_171205_171205&e=.csv&cn=SPFB.RTS-12.17&dtf=1&tmf=1&MSOR=0&mstime=on&mstimever=1&sep=1&sep2=1&datf=1&at=1" required/>
            <input type="submit" value="Send request"/>
        </form>
        <br/>
		<table id="tasks"></table>
		<hr/>
		<table id="responses"></table>
        
    </body>
</html>
